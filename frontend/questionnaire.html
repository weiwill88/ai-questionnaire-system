<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI应用需求调研</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .question-card {
            transition: all 0.3s ease;
        }
        .question-card.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        input[type="radio"]:checked + label,
        input[type="checkbox"]:checked + label {
            background-color: #dbeafe;
            border-color: #3b82f6;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-50">

<!-- 加载提示 -->
<div id="loadingOverlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: white; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column;">
    <div style="text-align: center;">
        <div style="font-size: 48px; margin-bottom: 20px;">⏳</div>
        <div style="font-size: 18px; color: #666;">页面加载中...</div>
        <div id="loadError" style="display: none; margin-top: 20px; padding: 15px; background: #fee; border: 1px solid #fcc; border-radius: 8px; color: #c00; max-width: 300px;">
            加载失败，请检查网络连接后刷新页面
        </div>
    </div>
</div>

<!-- ===== 配置区域 ===== -->
<script>
const CONFIG = {
    SUPABASE_URL: 'https://rnidqivrrsbcemywpryk.supabase.co',
    SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJuaWRxaXZycnNiY2VteXdwcnlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwOTcwNzUsImV4cCI6MjA3ODY3MzA3NX0.TN8eCSMXAQM6mQcrzIw7ZlkE1d2Z7UZm_I0lYsI3Tek',
    SESSION_ID: 'SJTU_SAIF_PROD'
};

// 检测资源加载
window.addEventListener('load', function() {
    setTimeout(function() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            if (typeof window.supabase !== 'undefined') {
                overlay.style.display = 'none';
            } else {
                document.getElementById('loadError').style.display = 'block';
            }
        }
    }, 1000);
});

// 超时检测
setTimeout(function() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay && overlay.style.display !== 'none') {
        document.getElementById('loadError').style.display = 'block';
    }
}, 10000);
</script>

<div class="min-h-screen pb-20">
    
    <!-- 头部 -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-6 px-4 shadow-lg">
        <h1 class="text-2xl font-bold text-center">AI应用现状与需求调研</h1>
        <p class="text-center text-blue-100 mt-2">上海交通大学高级金融学院 MBA 课程</p>
        <p class="text-center text-sm text-blue-200 mt-2">⏱ 预计填写时间：2-3 分钟</p>
    </header>

    <div class="max-w-2xl mx-auto px-4 py-6">
        
        <form id="questionnaire-form" class="space-y-4">

            <!-- Q1: 机构类型 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q1">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">1. 您目前主要所在的机构类型是？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="bank" id="q1-1" class="hidden" required>
                        <label for="q1-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            银行（含政策性银行、商业银行）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="securities" id="q1-2" class="hidden">
                        <label for="q1-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            证券公司
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="fund" id="q1-3" class="hidden">
                        <label for="q1-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            基金公司（公募 / 私募 / 资管）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="futures" id="q1-4" class="hidden">
                        <label for="q1-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            期货公司
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="insurance" id="q1-5" class="hidden">
                        <label for="q1-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            保险公司
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="trust" id="q1-6" class="hidden">
                        <label for="q1-6" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            信托公司
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="other_licensed" id="q1-7" class="hidden">
                        <label for="q1-7" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            其他持牌金融机构（如消费金融、金融租赁、金控集团等）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="fintech" id="q1-8" class="hidden">
                        <label for="q1-8" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            金融科技公司（非持牌）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q1_industry" value="other" id="q1-9" class="hidden">
                        <label for="q1-9" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            其他行业
                        </label>
                    </div>
                    <input type="text" id="q1_industry_other" placeholder="请填写您所在的行业" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg hidden mt-2" maxlength="100">
                </div>
            </div>

            <!-- Q2: 工作方向 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q2">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">2. 您目前在机构中的主要工作方向是？</span>
                    <span class="text-red-500">*</span>
                </label>
                <p class="text-sm text-gray-500 mb-3">请选择最贴近的一项</p>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="corporate" id="q2-1" class="hidden" required>
                        <label for="q2-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            对公 / 公司金融业务
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="retail" id="q2-2" class="hidden">
                        <label for="q2-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            对私 / 零售 / 财富管理
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="investment" id="q2-3" class="hidden">
                        <label for="q2-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            投研 / 交易 / 资产管理
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="risk" id="q2-4" class="hidden">
                        <label for="q2-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            风控 / 合规 / 法务 / 审计
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="ops" id="q2-5" class="hidden">
                        <label for="q2-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            运营 / 中后台支持
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="product" id="q2-6" class="hidden">
                        <label for="q2-6" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            产品 / 项目 / 业务规划
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="tech" id="q2-7" class="hidden">
                        <label for="q2-7" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            科技 / IT / 数据 / 基础设施
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q2_role" value="other" id="q2-8" class="hidden">
                        <label for="q2-8" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            其他
                        </label>
                    </div>
                    <input type="text" id="q2_role_other" placeholder="请填写您的工作方向" 
                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg hidden mt-2" maxlength="100">
                </div>
            </div>

            <!-- Q3: 数字工具习惯 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q3">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">3. 您平时在工作中使用数字工具的习惯更接近哪一项？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q3_digital_habit" value="1" id="q3-1" class="hidden" required>
                        <label for="q3-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            主要使用 Office 等基础工具完成工作
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q3_digital_habit" value="2" id="q3-2" class="hidden">
                        <label for="q3-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            会用 Excel 高级功能（数据透视、复杂公式等）或简单的 BI 报表
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q3_digital_habit" value="3" id="q3-3" class="hidden">
                        <label for="q3-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            会使用 SQL 查询数据，或用 Python/VBA 等写简单脚本
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q3_digital_habit" value="4" id="q3-4" class="hidden">
                        <label for="q3-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            能独立搭建小工具或自动化流程（如 RPA、低代码平台等）
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q4: AI应用自我定位 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q4">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">4. 您认为自己目前在 AI 应用上更接近哪种状态？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q4_ai_self_position" value="1" id="q4-1" class="hidden" required>
                        <label for="q4-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            好奇观望：知道 AI 很火，但还没找到切入点
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q4_ai_self_position" value="2" id="q4-2" class="hidden">
                        <label for="q4-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            个人用户：自己在用，但还没想过怎么在团队推广
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q4_ai_self_position" value="3" id="q4-3" class="hidden">
                        <label for="q4-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            场景探索：正在寻找适合自己业务的落地场景
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q4_ai_self_position" value="4" id="q4-4" class="hidden">
                        <label for="q4-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            推动落地：正在或准备推动部门/机构的 AI 项目
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q5: AI工具使用情况 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q5">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">5. 您目前使用 AI / 大模型类工具（如 ChatGPT、国内大模型等）的情况？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q5_ai_usage" value="1" id="q5-1" class="hidden" required>
                        <label for="q5-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            还没怎么用过，或偶尔尝试但没形成习惯
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q5_ai_usage" value="2" id="q5-2" class="hidden">
                        <label for="q5-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            偶尔用来查资料、润色文案、写邮件 / 汇报
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q5_ai_usage" value="3" id="q5-3" class="hidden">
                        <label for="q5-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            经常使用，已经有固定的提示词 / 模板辅助日常工作
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q5_ai_usage" value="4" id="q5-4" class="hidden">
                        <label for="q5-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            除了日常办公，还会用 AI 做分析、设计方案或梳理流程
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q5_ai_usage" value="5" id="q5-5" class="hidden">
                        <label for="q5-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            在团队内部推动 AI 的使用（培训、推广、制定规范等）
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q6: 机构AI阶段 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q6">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">6. 从您的观察看，您所在的机构在 AI / 大模型应用上的阶段更接近？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q6_org_stage" value="1" id="q6-1" class="hidden" required>
                        <label for="q6-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            主要还在调研和讨论阶段，暂时没有正式项目
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q6_org_stage" value="2" id="q6-2" class="hidden">
                        <label for="q6-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            某些部门或团队在做小范围试点
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q6_org_stage" value="3" id="q6-3" class="hidden">
                        <label for="q6-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            已经在多个业务场景中有稳定使用
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q6_org_stage" value="4" id="q6-4" class="hidden">
                        <label for="q6-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            有比较清晰的整体规划或统一平台，正在推进落地
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q6_org_stage" value="5" id="q6-5" class="hidden">
                        <label for="q6-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            不方便判断 / 不确定
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q7: 个人项目角色 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q7">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">7. 您个人在机构内与 AI / 数字化相关项目中的角色更接近哪一项？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q7_personal_role" value="1" id="q7-1" class="hidden" required>
                        <label for="q7-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            使用者：主要是使用现有工具完成工作
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q7_personal_role" value="2" id="q7-2" class="hidden">
                        <label for="q7-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            参与者：参与过相关项目的讨论 / 需求 / 试点
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q7_personal_role" value="3" id="q7-3" class="hidden">
                        <label for="q7-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            推动者：负责或协助推动本部门的相关项目落地
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q7_personal_role" value="4" id="q7-4" class="hidden">
                        <label for="q7-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            观察者：目前未直接参与相关项目，但会关注相关信息
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q8: 痛点场景（多选） -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q8">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">8. 您日常工作中，最希望 AI 帮忙减负的场景是？</span>
                    <span class="text-red-500">*</span>
                </label>
                <p class="text-sm text-gray-500 mb-3">多选题，最多选择 3 项</p>
                <p id="q8-count" class="text-xs text-blue-600 mb-2">已选择 0 项</p>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="report_integration" id="q8-1" class="hidden">
                        <label for="q8-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            定期报表整合（每周/月整合多份数据、发送给不同对象）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="doc_writing" id="q8-2" class="hidden">
                        <label for="q8-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            周报/月报撰写（格式化文档、总结性材料）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="research_reading" id="q8-3" class="hidden">
                        <label for="q8-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            研报/公告快速阅读（信息量大、需提取关键点）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="customer_qa" id="q8-4" class="hidden">
                        <label for="q8-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            客户问题答疑（重复性问题多、响应压力大）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="compliance_review" id="q8-5" class="hidden">
                        <label for="q8-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            合规/风控审查（文档多、时间紧、标准复杂）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="data_reconciliation" id="q8-6" class="hidden">
                        <label for="q8-6" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            数据核对/对账（人工比对易出错、效率低）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="policy_search" id="q8-7" class="hidden">
                        <label for="q8-7" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            内部制度查询（文档分散、查找困难）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="code_dev" id="q8-8" class="hidden">
                        <label for="q8-8" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            代码/脚本开发（需要技术辅助但不是专业开发人员）
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q8_pain_points" value="none" id="q8-9" class="hidden">
                        <label for="q8-9" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            目前暂时没有特别明确的痛点
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q9: 对AI的态度 -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q9">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">9. 在 AI 应用这件事上，您目前的真实感受更接近？</span>
                    <span class="text-red-500">*</span>
                </label>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="q9_attitude" value="1" id="q9-1" class="hidden" required>
                        <label for="q9-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            兴奋期待：觉得机会很大，想尽快尝试
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q9_attitude" value="2" id="q9-2" class="hidden">
                        <label for="q9-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            理性乐观：看好长期价值，但需要找准切入点
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q9_attitude" value="3" id="q9-3" class="hidden">
                        <label for="q9-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            谨慎观望：有兴趣，但担心风险或投入产出
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q9_attitude" value="4" id="q9-4" class="hidden">
                        <label for="q9-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            被动应对：觉得是趋势，不得不了解，但动力不强
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="q9_attitude" value="5" id="q9-5" class="hidden">
                        <label for="q9-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            存在顾虑：对数据安全、合规、可控性等有明确担忧
                        </label>
                    </div>
                </div>
            </div>

            <!-- Q10: 推进约束（可选多选） -->
            <div class="question-card bg-white rounded-lg shadow p-5" data-question="q10">
                <label class="block mb-3">
                    <span class="text-lg font-semibold text-gray-800">10. 在您所在的机构推进 AI 应用时，您认为最大的现实约束是什么？</span>
                    <span class="text-gray-400 text-sm ml-2">(可选)</span>
                </label>
                <p class="text-sm text-gray-500 mb-3">多选题，最多选择 3 项</p>
                <p id="q10-count" class="text-xs text-blue-600 mb-2">已选择 0 项</p>
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="data_security" id="q10-1" class="hidden">
                        <label for="q10-1" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            数据安全与合规要求
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="it_resource" id="q10-2" class="hidden">
                        <label for="q10-2" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            IT / 技术资源有限，排期紧张
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="user_adoption" id="q10-3" class="hidden">
                        <label for="q10-3" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            业务部门的接受度和使用习惯
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="unclear_scenario" id="q10-4" class="hidden">
                        <label for="q10-4" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            缺乏明确的业务场景和试点方向
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="roi_uncertain" id="q10-5" class="hidden">
                        <label for="q10-5" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            投入产出不确定，上层决策谨慎
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="low_priority" id="q10-6" class="hidden">
                        <label for="q10-6" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            目前感知不强，AI 还不是优先事项
                        </label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="q10_constraints" value="other" id="q10-7" class="hidden">
                        <label for="q10-7" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition">
                            其他
                        </label>
                    </div>
                </div>
            </div>

            <!-- 提交按钮 -->
            <div class="sticky bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg">
                <button type="submit" id="submit-btn" disabled
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 rounded-lg font-bold text-lg transition opacity-50 cursor-not-allowed">
                    提交问卷
                </button>
                <p class="text-center text-sm text-gray-500 mt-2">
                    已完成 <span id="progress-count">0</span> / 9 题必答题
                </p>
            </div>

        </form>

        <!-- 提交成功提示 -->
        <div id="success-message" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-sm mx-4 text-center">
                <div class="text-6xl mb-4">✅</div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">提交成功！</h2>
                <p class="text-gray-600">感谢您的参与，您的反馈将帮助我们提供更有针对性的内容。</p>
            </div>
        </div>

    </div>
</div>

<script>
// ===== 全局变量 =====
const startTime = Date.now();
let formData = {};
const STORAGE_KEY = `questionnaire_submitted_${CONFIG.SESSION_ID}`;

// ===== 页面加载完成后初始化 =====
document.addEventListener('DOMContentLoaded', function() {
    // 检查是否已提交过
    if (checkIfAlreadySubmitted()) {
        showAlreadySubmittedMessage();
        return;
    }
    // 监听Q1的"其他"选项
    document.querySelectorAll('input[name="q1_industry"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const otherInput = document.getElementById('q1_industry_other');
            if (this.value === 'other') {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
                otherInput.value = '';
            }
            updateProgress();
        });
    });

    // 监听Q2的"其他"选项
    document.querySelectorAll('input[name="q2_role"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const otherInput = document.getElementById('q2_role_other');
            if (this.value === 'other') {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
                otherInput.value = '';
            }
            updateProgress();
        });
    });

    // 监听所有必填题变化
    document.querySelectorAll('input[required]').forEach(input => {
        input.addEventListener('change', updateProgress);
    });

    // 监听Q8多选（至少选1项，最多3项）
    document.querySelectorAll('input[name="q8_pain_points"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            handleMultipleChoice('q8_pain_points', 3, 'q8-count');
            updateProgress();
        });
    });

    // 监听Q10多选（最多3项）
    document.querySelectorAll('input[name="q10_constraints"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            handleMultipleChoice('q10_constraints', 3, 'q10-count');
        });
    });

    // 表单提交
    document.getElementById('questionnaire-form').addEventListener('submit', handleSubmit);

    // 初始化进度
    updateProgress();
    
    // 初始化多选题计数器
    handleMultipleChoice('q8_pain_points', 3, 'q8-count');
    handleMultipleChoice('q10_constraints', 3, 'q10-count');
});

// ===== 处理多选题数量限制 =====
function handleMultipleChoice(name, maxSelections, counterId) {
    const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
    const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
    const count = checked.length;
    
    // 更新计数显示
    const counter = document.getElementById(counterId);
    counter.textContent = `已选择 ${count} 项`;
    
    // 如果超过最大数量，改变颜色提示
    if (count > maxSelections) {
        counter.classList.add('text-red-500');
        counter.classList.remove('text-blue-600');
    } else {
        counter.classList.add('text-blue-600');
        counter.classList.remove('text-red-500');
    }
    
    // 如果达到最大数量，禁用其他未选中的复选框
    if (count >= maxSelections) {
        checkboxes.forEach(cb => {
            if (!cb.checked) {
                cb.disabled = true;
                cb.parentElement.querySelector('label').classList.add('opacity-50', 'cursor-not-allowed');
            }
        });
    } else {
        // 重新启用所有复选框
        checkboxes.forEach(cb => {
            cb.disabled = false;
            cb.parentElement.querySelector('label').classList.remove('opacity-50', 'cursor-not-allowed');
        });
    }
}

// ===== 更新进度 =====
function updateProgress() {
    let completed = 0;
    
    // Q1-Q7, Q9 单选题
    ['q1_industry', 'q2_role', 'q3_digital_habit', 'q4_ai_self_position', 
     'q5_ai_usage', 'q6_org_stage', 'q7_personal_role', 'q9_attitude'].forEach(name => {
        const checked = document.querySelector(`input[name="${name}"]:checked`);
        if (checked) {
            // 如果是Q1或Q2且选了"其他"，检查输入框
            if (name === 'q1_industry' && checked.value === 'other') {
                if (document.getElementById('q1_industry_other').value.trim()) {
                    completed++;
                }
            } else if (name === 'q2_role' && checked.value === 'other') {
                if (document.getElementById('q2_role_other').value.trim()) {
                    completed++;
                }
            } else {
                completed++;
            }
        }
    });

    // Q8 多选题（至少选1项，最多3项）
    const q8Checked = document.querySelectorAll('input[name="q8_pain_points"]:checked');
    if (q8Checked.length >= 1 && q8Checked.length <= 3) {
        completed++;
    }

    // 更新进度显示
    document.getElementById('progress-count').textContent = completed;

    // 启用/禁用提交按钮
    const submitBtn = document.getElementById('submit-btn');
    if (completed === 9) {
        submitBtn.disabled = false;
        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        submitBtn.classList.add('hover:from-blue-700', 'hover:to-indigo-700');
    } else {
        submitBtn.disabled = true;
        submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        submitBtn.classList.remove('hover:from-blue-700', 'hover:to-indigo-700');
    }
    
    console.log('当前进度:', completed, '/ 9');
}

// ===== 检查是否已提交 =====
function checkIfAlreadySubmitted() {
    // 检查localStorage
    const submitted = localStorage.getItem(STORAGE_KEY);
    if (submitted) {
        const submitData = JSON.parse(submitted);
        // 检查是否在24小时内提交过（可选）
        const submitTime = new Date(submitData.timestamp);
        const now = new Date();
        const hoursDiff = (now - submitTime) / (1000 * 60 * 60);
        
        // 24小时内算已提交
        if (hoursDiff < 24) {
            return true;
        }
    }
    return false;
}

// ===== 显示已提交提示 =====
function showAlreadySubmittedMessage() {
    document.getElementById('questionnaire-form').innerHTML = `
        <div class="text-center py-12">
            <div class="text-6xl mb-4">✅</div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">您已提交过问卷</h2>
            <p class="text-gray-600 mb-6">感谢您的参与！每人只能提交一次问卷。</p>
            <p class="text-sm text-gray-400">如需修改，请联系管理员</p>
        </div>
    `;
}

// ===== 标记为已提交 =====
function markAsSubmitted(responseId) {
    const submitData = {
        timestamp: new Date().toISOString(),
        responseId: responseId,
        sessionId: CONFIG.SESSION_ID
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(submitData));
}

// ===== 生成浏览器指纹（用于后端防重复） =====
async function generateFingerprint() {
    const components = [
        navigator.userAgent,
        navigator.language,
        screen.width + 'x' + screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        !!window.sessionStorage,
        !!window.localStorage
    ];
    
    const fingerprint = components.join('|');
    
    // 使用Web Crypto API生成SHA-256哈希
    const encoder = new TextEncoder();
    const data = encoder.encode(fingerprint);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    
    return hashHex;
}

// ===== 获取设备类型 =====
function getDeviceType() {
    const ua = navigator.userAgent;
    if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
        return 'tablet';
    }
    if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
        return 'mobile';
    }
    return 'desktop';
}

// ===== 处理表单提交 =====
async function handleSubmit(e) {
    e.preventDefault();

    // 验证Q8和Q10不超过3个
    const q8Count = document.querySelectorAll('input[name="q8_pain_points"]:checked').length;
    const q10Count = document.querySelectorAll('input[name="q10_constraints"]:checked').length;
    
    if (q8Count > 3) {
        alert('问题8最多只能选择3项，请重新选择');
        return;
    }
    
    if (q10Count > 3) {
        alert('问题10最多只能选择3项，请重新选择');
        return;
    }

    // 计算填写耗时
    const completionTimeSeconds = Math.floor((Date.now() - startTime) / 1000);

    // 生成浏览器指纹（用于后端防重复提交）
    const fingerprint = await generateFingerprint();

    // 收集表单数据
    const formData = {
        session_id: CONFIG.SESSION_ID,
        
        // Q1
        q1_industry: document.querySelector('input[name="q1_industry"]:checked').value,
        q1_industry_other: document.getElementById('q1_industry_other').value || null,
        
        // Q2
        q2_role: document.querySelector('input[name="q2_role"]:checked').value,
        q2_role_other: document.getElementById('q2_role_other').value || null,
        
        // Q3-Q7, Q9 单选题（转为整数）
        q3_digital_habit: parseInt(document.querySelector('input[name="q3_digital_habit"]:checked').value),
        q4_ai_self_position: parseInt(document.querySelector('input[name="q4_ai_self_position"]:checked').value),
        q5_ai_usage: parseInt(document.querySelector('input[name="q5_ai_usage"]:checked').value),
        q6_org_stage: parseInt(document.querySelector('input[name="q6_org_stage"]:checked').value),
        q7_personal_role: parseInt(document.querySelector('input[name="q7_personal_role"]:checked').value),
        q9_attitude: parseInt(document.querySelector('input[name="q9_attitude"]:checked').value),
        
        // Q8 多选题（数组）
        q8_pain_points: Array.from(document.querySelectorAll('input[name="q8_pain_points"]:checked'))
            .map(cb => cb.value),
        
        // Q10 可选多选题（数组或null）
        q10_constraints: Array.from(document.querySelectorAll('input[name="q10_constraints"]:checked'))
            .map(cb => cb.value),
        
        // 元数据
        completion_time_seconds: completionTimeSeconds,
        device_type: getDeviceType(),
        user_agent: navigator.userAgent,
        ip_hash: fingerprint  // 浏览器指纹（用于后端防重复提交）
    };

    // 如果Q10没选，设为null
    if (formData.q10_constraints.length === 0) {
        formData.q10_constraints = null;
    }

    console.log('提交数据:', formData);

    // 防止快速重复点击
    const submitBtn = document.getElementById('submit-btn');
    if (submitBtn.disabled) {
        return; // 如果按钮已禁用，直接返回
    }
    
    // 显示加载状态
    submitBtn.disabled = true;
    submitBtn.textContent = '提交中...';

    try {
        // 直接提交到Supabase
        const supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
        
        const { data, error } = await supabase
            .from('responses')
            .insert([formData])
            .select();

        if (error) {
            throw new Error(error.message || '提交失败');
        }

        console.log('提交成功:', data);

        // 标记为已提交（localStorage）
        markAsSubmitted(data[0]?.id || 'unknown');

        // 显示成功提示
        document.getElementById('success-message').classList.remove('hidden');

        // 3秒后隐藏表单并显示已提交提示
        setTimeout(() => {
            showAlreadySubmittedMessage();
        }, 3000);

    } catch (error) {
        console.error('提交失败:', error);
        console.error('错误详情:', {
            message: error.message,
            stack: error.stack,
            supabaseAvailable: typeof window.supabase !== 'undefined'
        });
        
        let errorMessage = '提交失败，请检查网络连接或稍后重试。\n\n';
        if (typeof window.supabase === 'undefined') {
            errorMessage += '错误：Supabase SDK未加载，请刷新页面重试。';
        } else {
            errorMessage += '错误信息: ' + error.message;
        }
        
        alert(errorMessage);
        submitBtn.disabled = false;
        submitBtn.textContent = '提交问卷';
    }
}

</script>

</body>
</html>

